<header class=" mypage-wrapper">
    <div class="container">
        <div class="text-center my-5">
            <h1 class="fw-bolder mypage-header">Welcome to Localmapping!</h1>
            <p class="lead mb-0 pull-right">ようこそ！　<%= current_user.name %>さん</p>
        </div>
    </div>
</header>
<!-- Page content-->
<div class="container mypage-container">
    <div class="row">
        <!-- マイページ（メイン部分）-->
        <div class="col-lg-8">
            <!-- いいね順のランキング（最寄駅で検索（USERの最寄駅ベース））-->
            <div class="card mb-4">
                <div class="card-body">
                    <h2 class="card-title">人気ランキング</h2>
                </div>
                <!--<img class="card-img-top" src="https://dummyimage.com/850x350/dee2e6/6c757d.jpg" alt="..." />-->
                <div class="card-img-top card-ranking-map" id='map_mypage'></div>
                <ul class="list-group list-group-flush">
                    <li class="list-group-item">Top１（いいね順番）</li>
                    <li class="list-group-item">Top２（いいね順番）</li>
                    <li class="list-group-item">Top３（いいね順番）</li>
                    <div id="debug"></div>
                </ul>
            </div>
            <!-- オススメ（投稿日が最新のもの上位４件）　-->
            <div class="text-center">
                <h2 calss="fw-bolder">オススメスポット</h2>
            </div>
            <!-- Rails でTopicsを取得してLOOPさせる。 -->
            <div class="row">
                <div class="col-lg-6">
                    <!-- Blog post-->
                    <div class="card mb-4">
                        <a href="#!"><img class="card-img-top" src="https://dummyimage.com/700x350/dee2e6/6c757d.jpg" alt="..." /></a>
                        <div class="card-body">
                            <div class="small text-muted">January 1, 2021</div>
                            <h2 class="card-title h4">Post Title</h2>
                            <p class="card-text">Lorem ipsum dolor sit amet, consectetur adipisicing elit. Reiciendis aliquid atque, nulla.</p>
                            <a class="btn btn-primary" href="#!">Read more →</a>
                        </div>
                    </div>
                    <!-- Blog post-->
                    <div class="card mb-4">
                        <a href="#!"><img class="card-img-top" src="https://dummyimage.com/700x350/dee2e6/6c757d.jpg" alt="..." /></a>
                        <div class="card-body">
                            <div class="small text-muted">January 1, 2021</div>
                            <h2 class="card-title h4">Post Title</h2>
                            <p class="card-text">Lorem ipsum dolor sit amet, consectetur adipisicing elit. Reiciendis aliquid atque, nulla.</p>
                            <a class="btn btn-primary" href="#!">Read more →</a>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <!-- Blog post-->
                    <div class="card mb-4">
                        <a href="#!"><img class="card-img-top" src="https://dummyimage.com/700x350/dee2e6/6c757d.jpg" alt="..." /></a>
                        <div class="card-body">
                            <div class="small text-muted">January 1, 2021</div>
                            <h2 class="card-title h4">Post Title</h2>
                            <p class="card-text">Lorem ipsum dolor sit amet, consectetur adipisicing elit. Reiciendis aliquid atque, nulla.</p>
                            <a class="btn btn-primary" href="#!">Read more →</a>
                        </div>
                    </div>
                    <!-- Blog post-->
                    <div class="card mb-4">
                        <a href="#!"><img class="card-img-top" src="https://dummyimage.com/700x350/dee2e6/6c757d.jpg" alt="..." /></a>
                        <div class="card-body">
                            <div class="small text-muted">January 1, 2021</div>
                            <h2 class="card-title h4">Post Title</h2>
                            <p class="card-text">Lorem ipsum dolor sit amet, consectetur adipisicing elit. Reiciendis aliquid atque, nulla? Quos cum ex quis soluta, a laboriosam.</p>
                            <a class="btn btn-primary" href="#!">Read more →</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- 左部分のコンテナ(Myスポット、投稿一覧(簡易的)、MyPage(未実装)）) -->
        <div class="col-lg-4">
            <!-- Myスポット -->
            <div class="card mb-4">
                <div class="card-header"><a href="#">Myスポット</a></div>
                <div class="card-body">
                    <ul class="list-group list-group-flush">
                        <% @topics.each do |topic| %>
                                <li class="list-group-item">
                                    <div class="myspot-container">
                                        <div class="myspot-left">
                                            <% unless topic.picture_1.url.nil? %>
                                                <%= image_tag topic.picture_1.url, class: "myspot-picture" %>
                                            <% end %>
                                        </div>
                                        <div class="myspot-right">
                                            <div><strong>タイトル：</strong><%= topic.title %></div>
                                            <div><strong>最寄駅：</strong><%= topic.station %></div>
                                            <div><strong>投稿者：</strong><%= topic.user.name %></div>
                                            <div><strong>更新日：</strong><%= topic.updated_at.strftime('%Y/%m/%d %H:%M:%S') %></div>
                                        </div>
                                        <div class="myspot-show">
                                            <a class="btn btn-primary" href="/topics/<%= topic.id %>">投稿へ →</a>
                                        </div>
                                    </div>
                                </li>
                        <% end %>
                    </ul>
                </div>
            </div>
            <!-- Categories widget-->
            <div class="card mb-4">
                <div class="card-header">投稿一覧</div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-sm-6">
                            <ul class="list-unstyled mb-0">
                                <li><a href="/topic/3">URL直打ちで飛べるか？JS用</a></li>
                                <li><a href="#!">Web Design</a></li>
                                <li><a href="#!">HTML</a></li>
                                <li><a href="#!">Freebies</a></li>
                            </ul>
                        </div>
                        <div class="col-sm-6">
                            <ul class="list-unstyled mb-0">
                                <li><a href="#!">JavaScript</a></li>
                                <li><a href="#!">CSS</a></li>
                                <li><a href="#!">Tutorials</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <!-- ユーザ情報 -->
            <div class="card mb-4">
                <div class="card-header">Side Widget</div>
                <div class="card-body">You can put anything you want inside of these side widgets. They are easy to use, and feature the Bootstrap 5 card component!</div>
            </div>
        </div>
    </div>
</div>



<script>
let map
let geocoder
const topics_rank = gon.topics_rank //Controllerで取得したいいねランキングの上位Topics

for (let i = 0; i < topics_rank.length; i++) {
// alert(topics_rank[i].latitude + "緯度経度" +topics_rank[i].longitude);
document.getElementById('debug').textContent += i + "←ID"+ topics_rank[i].latitude + "緯度経度" +topics_rank[i].longitude+ "---";
}

function initMap(){
    geocoder = new google.maps.Geocoder()

    map = new google.maps.Map(document.getElementById('map_mypage'), {
        center: {lat: 35.681236, lng: 139.767125},
        zoom: 15,
    });

    // ドラッグ不可のマーカー
    marker = new google.maps.Marker({
        position: {lat: 35.681236, lng: 139.767125},
        map: map
    });
}

</script>

<script src="https://maps.googleapis.com/maps/api/js?key=<%= @env %>&callback=initMap" async defer></script>